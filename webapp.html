<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EA Budget</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles to ensure full height and font */
        html, body {
            height: 100%;
            margin: 0;
            font-family: 'Inter', sans-serif; /* Using Inter font */
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        #app {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        /* Hide scrollbar for a cleaner look */
        body::-webkit-scrollbar {
            display: none;
        }
        body {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
        /* Specific styling for active tab border */
        .tab-btn.active {
            border-bottom: 3px solid #FBC02D; /* A darker yellow for active tab indicator */
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100">
    <div id="app" class="max-w-4xl mx-auto rounded-lg shadow-xl overflow-hidden md:my-8 my-4">
        <!-- Header -->
        <header class="bg-yellow-400 text-gray-900 p-4 shadow-md rounded-t-lg">
            <h1 class="text-3xl font-bold text-center">EA Budget</h1>
        </header>

        <!-- Tab Navigation -->
        <nav class="bg-gray-800 p-2 flex justify-around rounded-b-lg">
            <button class="tab-btn py-3 px-4 text-lg font-semibold flex-1 text-center rounded-lg hover:bg-gray-700 transition-colors duration-200 active" data-tab="revenues">Revenues</button>
            <button class="tab-btn py-3 px-4 text-lg font-semibold flex-1 text-center rounded-lg hover:bg-gray-700 transition-colors duration-200" data-tab="expenses">Expenses</button>
            <button class="tab-btn py-3 px-4 text-lg font-semibold flex-1 text-center rounded-lg hover:bg-gray-700 transition-colors duration-200" data-tab="summary">Summary</button>
        </nav>

        <!-- Tab Content -->
        <main class="flex-1 p-6 bg-gray-900 text-gray-100">
            <!-- Revenues Tab Content -->
            <section id="revenues" class="tab-content">
                <h2 class="text-2xl font-bold text-yellow-400 mb-6 text-center">Register New Revenue</h2>

                <!-- Studio Booking Form -->
                <div class="bg-gray-800 p-5 mb-6 rounded-xl shadow-lg">
                    <h3 class="text-xl font-semibold mb-4 text-yellow-400">Studio Booking</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="studioAmount" class="block text-sm font-medium text-gray-300">Amount (ETB)</label>
                            <input type="number" id="studioAmount" class="mt-1 block w-full p-3 rounded-md bg-gray-700 border border-gray-600 text-gray-100 focus:ring-yellow-500 focus:border-yellow-500 shadow-sm" placeholder="e.g., 500" required>
                        </div>
                        <div>
                            <label for="studioDate" class="block text-sm font-medium text-gray-300">Date</label>
                            <input type="date" id="studioDate" class="mt-1 block w-full p-3 rounded-md bg-gray-700 border border-gray-600 text-gray-100 focus:ring-yellow-500 focus:border-yellow-500 shadow-sm" required>
                        </div>
                    </div>
                    <button class="add-revenue-btn mt-6 w-full py-3 bg-yellow-500 text-gray-900 font-bold rounded-md hover:bg-yellow-600 transition-colors duration-200 shadow-md transform hover:scale-105" data-type="studio">Add Studio Revenue</button>
                </div>

                <!-- Photo Shooting Form -->
                <div class="bg-gray-800 p-5 mb-6 rounded-xl shadow-lg">
                    <h3 class="text-xl font-semibold mb-4 text-yellow-400">Photo Shooting</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="photoAmount" class="block text-sm font-medium text-gray-300">Amount (ETB)</label>
                            <input type="number" id="photoAmount" class="mt-1 block w-full p-3 rounded-md bg-gray-700 border border-gray-600 text-gray-100 focus:ring-yellow-500 focus:border-yellow-500 shadow-sm" placeholder="e.g., 1200" required>
                        </div>
                        <div>
                            <label for="photoDate" class="block text-sm font-medium text-gray-300">Date</label>
                            <input type="date" id="photoDate" class="mt-1 block w-full p-3 rounded-md bg-gray-700 border border-gray-600 text-gray-100 focus:ring-yellow-500 focus:border-yellow-500 shadow-sm" required>
                        </div>
                    </div>
                    <button class="add-revenue-btn mt-6 w-full py-3 bg-yellow-500 text-gray-900 font-bold rounded-md hover:bg-yellow-600 transition-colors duration-200 shadow-md transform hover:scale-105" data-type="photo">Add Photo Revenue</button>
                </div>

                <!-- Video Recording Form -->
                <div class="bg-gray-800 p-5 rounded-xl shadow-lg">
                    <h3 class="text-xl font-semibold mb-4 text-yellow-400">Video Recording</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="videoAmount" class="block text-sm font-medium text-gray-300">Amount (ETB)</label>
                            <input type="number" id="videoAmount" class="mt-1 block w-full p-3 rounded-md bg-gray-700 border border-gray-600 text-gray-100 focus:ring-yellow-500 focus:border-yellow-500 shadow-sm" placeholder="e.g., 2500" required>
                        </div>
                        <div>
                            <label for="videoDate" class="block text-sm font-medium text-gray-300">Date</label>
                            <input type="date" id="videoDate" class="mt-1 block w-full p-3 rounded-md bg-gray-700 border border-gray-600 text-gray-100 focus:ring-yellow-500 focus:border-yellow-500 shadow-sm" required>
                        </div>
                    </div>
                    <button class="add-revenue-btn mt-6 w-full py-3 bg-yellow-500 text-gray-900 font-bold rounded-md hover:bg-yellow-600 transition-colors duration-200 shadow-md transform hover:scale-105" data-type="video">Add Video Revenue</button>
                </div>

                <div class="mt-8">
                    <h3 class="text-xl font-semibold mb-4 text-yellow-400">Recent Revenue Entries</h3>
                    <ul id="revenueList" class="space-y-3">
                        <!-- Revenue entries will be dynamically added here -->
                    </ul>
                </div>
            </section>

            <!-- Expenses Tab Content -->
            <section id="expenses" class="tab-content hidden">
                <h2 class="text-2xl font-bold text-yellow-400 mb-6 text-center">Register New Expense</h2>

                <div class="bg-gray-800 p-5 rounded-xl shadow-lg">
                    <h3 class="text-xl font-semibold mb-4 text-yellow-400">New Expense</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label for="expenseAmount" class="block text-sm font-medium text-gray-300">Amount (ETB)</label>
                            <input type="number" id="expenseAmount" class="mt-1 block w-full p-3 rounded-md bg-gray-700 border border-gray-600 text-gray-100 focus:ring-yellow-500 focus:border-yellow-500 shadow-sm" placeholder="e.g., 150" required>
                        </div>
                        <div>
                            <label for="expenseDate" class="block text-sm font-medium text-gray-300">Date</label>
                            <input type="date" id="expenseDate" class="mt-1 block w-full p-3 rounded-md bg-gray-700 border border-gray-600 text-gray-100 focus:ring-yellow-500 focus:border-yellow-500 shadow-sm" required>
                        </div>
                    </div>
                    <div>
                        <label for="expenseExplanation" class="block text-sm font-medium text-gray-300">Explanation</label>
                        <textarea id="expenseExplanation" rows="3" class="mt-1 block w-full p-3 rounded-md bg-gray-700 border border-gray-600 text-gray-100 focus:ring-yellow-500 focus:border-yellow-500 shadow-sm" placeholder="e.g., Office supplies, electricity bill"></textarea>
                    </div>
                    <button id="addExpenseBtn" class="mt-6 w-full py-3 bg-yellow-500 text-gray-900 font-bold rounded-md hover:bg-yellow-600 transition-colors duration-200 shadow-md transform hover:scale-105">Add Expense</button>
                </div>

                <div class="mt-8">
                    <h3 class="text-xl font-semibold mb-4 text-yellow-400">Recent Expense Entries</h3>
                    <ul id="expenseList" class="space-y-3">
                        <!-- Expense entries will be dynamically added here -->
                    </ul>
                </div>
            </section>

            <!-- Summary Tab Content -->
            <section id="summary" class="tab-content hidden">
                <h2 class="text-2xl font-bold text-yellow-400 mb-6 text-center">Financial Summary</h2>

                <div class="bg-gray-800 p-6 rounded-xl shadow-lg mb-6">
                    <h3 class="text-xl font-semibold mb-4 text-yellow-400">Total Revenues by Category</h3>
                    <div id="revenueSummary" class="space-y-2 text-lg">
                        <!-- Revenue summary will be dynamically added here -->
                    </div>
                </div>

                <div class="bg-gray-800 p-6 rounded-xl shadow-lg mb-6">
                    <h3 class="text-xl font-semibold mb-4 text-yellow-400">Overall Totals</h3>
                    <div class="space-y-2 text-lg">
                        <p class="flex justify-between items-center"><span class="font-medium">Total Revenues:</span> <span id="totalRevenues" class="text-green-400 font-bold">0 ETB</span></p>
                        <p class="flex justify-between items-center"><span class="font-medium">Total Expenses:</span> <span id="totalExpenses" class="text-red-400 font-bold">0 ETB</span></p>
                        <hr class="border-gray-700 my-2">
                        <p class="flex justify-between items-center"><span class="font-medium">Net Profit/Loss:</span> <span id="netProfitLoss" class="font-bold text-xl">0 ETB</span></p>
                    </div>
                </div>
            </section>

            <!-- Custom Message Box for alerts -->
            <div id="messageBox" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50">
                <div class="bg-gray-800 p-6 rounded-lg shadow-xl max-w-sm w-full text-center">
                    <p id="messageText" class="text-gray-100 text-lg mb-4"></p>
                    <button id="messageBoxCloseBtn" class="bg-yellow-500 text-gray-900 font-bold py-2 px-4 rounded-md hover:bg-yellow-600 transition-colors duration-200">OK</button>
                </div>
            </div>
             <!-- Custom confirmation box (for delete) -->
            <div id="confirmBox" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50">
                <div class="bg-gray-800 p-6 rounded-lg shadow-xl max-w-sm w-full text-center">
                    <p id="confirmText" class="text-gray-100 text-lg mb-4"></p>
                    <div class="flex justify-around">
                        <button id="confirmBoxYesBtn" class="bg-red-600 text-white font-bold py-2 px-4 rounded-md hover:bg-red-700 transition-colors duration-200 mr-2">Yes</button>
                        <button id="confirmBoxNoBtn" class="bg-gray-600 text-white font-bold py-2 px-4 rounded-md hover:bg-gray-700 transition-colors duration-200">No</button>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <script>
        // DOM Elements
        const tabButtons = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');
        const addRevenueButtons = document.querySelectorAll('.add-revenue-btn');
        const addExpenseBtn = document.getElementById('addExpenseBtn');
        const revenueList = document.getElementById('revenueList');
        const expenseList = document.getElementById('expenseList');
        const revenueSummary = document.getElementById('revenueSummary');
        const totalRevenuesEl = document.getElementById('totalRevenues');
        const totalExpensesEl = document.getElementById('totalExpenses');
        const netProfitLossEl = document.getElementById('netProfitLoss');
        const messageBox = document.getElementById('messageBox');
        const messageText = document.getElementById('messageText');
        const messageBoxCloseBtn = document.getElementById('messageBoxCloseBtn');
        const confirmBox = document.getElementById('confirmBox');
        const confirmText = document.getElementById('confirmText');
        const confirmBoxYesBtn = document.getElementById('confirmBoxYesBtn');
        const confirmBoxNoBtn = document.getElementById('confirmBoxNoBtn');


        // Data Storage (using localStorage)
        let revenues = JSON.parse(localStorage.getItem('eaBudgetRevenues')) || [];
        let expenses = JSON.parse(localStorage.getItem('eaBudgetExpenses')) || [];

        // Variable to store the resolve function for the custom confirmation box
        let confirmResolve;

        /**
         * Displays a custom message box instead of native alert().
         * @param {string} message - The message to display.
         */
        function showMessageBox(message) {
            messageText.textContent = message;
            messageBox.classList.remove('hidden');
        }

        /**
         * Hides the custom message box.
         */
        function hideMessageBox() {
            messageBox.classList.add('hidden');
        }

        /**
         * Displays a custom confirmation box.
         * @param {string} message - The message to display.
         * @returns {Promise<boolean>} A promise that resolves to true if 'Yes' is clicked, false otherwise.
         */
        function showConfirmBox(message) {
            confirmText.textContent = message;
            confirmBox.classList.remove('hidden');

            return new Promise(resolve => {
                confirmResolve = resolve;
            });
        }

        /**
         * Hides the custom confirmation box.
         */
        function hideConfirmBox() {
            confirmBox.classList.add('hidden');
        }

        // Event listener for message box close button
        messageBoxCloseBtn.addEventListener('click', hideMessageBox);

        // Event listeners for custom confirmation box
        confirmBoxYesBtn.addEventListener('click', () => {
            hideConfirmBox();
            if (confirmResolve) {
                confirmResolve(true);
                confirmResolve = null; // Clear the resolve function
            }
        });

        confirmBoxNoBtn.addEventListener('click', () => {
            hideConfirmBox();
            if (confirmResolve) {
                confirmResolve(false);
                confirmResolve = null; // Clear the resolve function
            }
        });


        /**
         * Saves the current revenues and expenses data to localStorage.
         */
        function saveData() {
            localStorage.setItem('eaBudgetRevenues', JSON.stringify(revenues));
            localStorage.setItem('eaBudgetExpenses', JSON.stringify(expenses));
            updateSummary(); // Update summary after saving
        }

        /**
         * Generates a unique ID for new entries.
         * @returns {string} A unique ID.
         */
        function generateUniqueId() {
            return Date.now().toString(36) + Math.random().toString(36).substring(2);
        }

        /**
         * Renders the list of revenue entries.
         */
        function renderRevenues() {
            revenueList.innerHTML = ''; // Clear existing list
            // Sort revenues by date, newest first
            const sortedRevenues = [...revenues].sort((a, b) => new Date(b.date) - new Date(a.date));

            sortedRevenues.forEach(entry => {
                const li = document.createElement('li');
                li.id = `revenue-${entry.id}`; // Add ID for easy removal
                li.className = 'bg-gray-800 p-4 rounded-lg flex justify-between items-center shadow-sm hover:bg-gray-700 transition-colors duration-200';
                li.innerHTML = `
                    <div>
                        <span class="text-yellow-400 font-medium">${entry.type.charAt(0).toUpperCase() + entry.type.slice(1).replace(/([A-Z])/g, ' $1').trim()}:</span>
                        <span class="font-bold text-gray-100">${entry.amount.toFixed(2)} ETB</span>
                        <p class="text-sm text-gray-400">${entry.date}</p>
                    </div>
                    <button class="delete-btn bg-red-600 hover:bg-red-700 text-white p-2 rounded-full focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50 transition-transform transform hover:scale-110" data-id="${entry.id}" data-type="revenue">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 011-1h4a1 1 0 110 2H8a1 1 0 01-1-1zm3 3a1 1 0 011 1v3a1 1 0 11-2 0v-3a1 1 0 011-1z" clip-rule="evenodd" />
                        </svg>
                    </button>
                `;
                revenueList.appendChild(li);
            });
        }

        /**
         * Renders the list of expense entries.
         */
        function renderExpenses() {
            expenseList.innerHTML = ''; // Clear existing list
            // Sort expenses by date, newest first
            const sortedExpenses = [...expenses].sort((a, b) => new Date(b.date) - new Date(a.date));

            sortedExpenses.forEach(entry => {
                const li = document.createElement('li');
                li.id = `expense-${entry.id}`; // Add ID for easy removal
                li.className = 'bg-gray-800 p-4 rounded-lg flex justify-between items-center shadow-sm hover:bg-gray-700 transition-colors duration-200';
                li.innerHTML = `
                    <div>
                        <span class="text-red-400 font-medium">Expense:</span>
                        <span class="font-bold text-gray-100">${entry.amount.toFixed(2)} ETB</span>
                        <p class="text-sm text-gray-400">Date: ${entry.date}</p>
                        <p class="text-sm text-gray-300">Explanation: ${entry.explanation || 'N/A'}</p>
                    </div>
                    <button class="delete-btn bg-red-600 hover:bg-red-700 text-white p-2 rounded-full focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50 transition-transform transform hover:scale-110" data-id="${entry.id}" data-type="expense">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 011-1h4a1 1 0 110 2H8a1 1 0 01-1-1zm3 3a1 1 0 011 1v3a1 1 0 11-2 0v-3a1 1 0 011-1z" clip-rule="evenodd" />
                        </svg>
                    </button>
                `;
                expenseList.appendChild(li);
            });
        }

        /**
         * Updates the summary section with total revenues, expenses, and net profit/loss.
         */
        function updateSummary() {
            let totalRevenues = 0;
            let totalExpenses = 0;
            const revenueByCategory = {
                studio: 0,
                photo: 0,
                video: 0
            };

            revenues.forEach(r => {
                totalRevenues += r.amount;
                revenueByCategory[r.type] += r.amount;
            });

            expenses.forEach(e => {
                totalExpenses += e.amount;
            });

            const netProfitLoss = totalRevenues - totalExpenses;

            // Update revenue summary by category
            revenueSummary.innerHTML = `
                <p class="flex justify-between items-center"><span class="font-medium">Studio Booking:</span> <span class="text-green-400 font-bold">${revenueByCategory.studio.toFixed(2)} ETB</span></p>
                <p class="flex justify-between items-center"><span class="font-medium">Photo Shooting:</span> <span class="text-green-400 font-bold">${revenueByCategory.photo.toFixed(2)} ETB</span></p>
                <p class="flex justify-between items-center"><span class="font-medium">Video Recording:</span> <span class="text-green-400 font-bold">${revenueByCategory.video.toFixed(2)} ETB</span></p>
            `;

            // Update overall totals
            totalRevenuesEl.textContent = `${totalRevenues.toFixed(2)} ETB`;
            totalExpensesEl.textContent = `${totalExpenses.toFixed(2)} ETB`;
            netProfitLossEl.textContent = `${netProfitLoss.toFixed(2)} ETB`;
            netProfitLossEl.classList.remove('text-green-400', 'text-red-400');
            netProfitLossEl.classList.add(netProfitLoss >= 0 ? 'text-green-400' : 'text-red-400');
        }

        /**
         * Initializes the app by rendering data and updating summary.
         */
        function initializeApp() {
            renderRevenues();
            renderExpenses();
            updateSummary();
            // Set current date as default for date inputs
            const today = new Date().toISOString().split('T')[0];
            document.querySelectorAll('input[type="date"]').forEach(input => {
                input.value = today;
            });
        }

        // Event Listeners for Tabs
        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                // Remove active class from all buttons
                tabButtons.forEach(btn => btn.classList.remove('active'));
                // Add active class to clicked button
                button.classList.add('active');

                // Hide all tab contents
                tabContents.forEach(content => content.classList.add('hidden'));
                // Show the content corresponding to the clicked button
                document.getElementById(button.dataset.tab).classList.remove('hidden');

                // Re-render summary if the summary tab is opened
                if (button.dataset.tab === 'summary') {
                    updateSummary();
                }
            });
        });

        // Event Listeners for Adding Revenue
        addRevenueButtons.forEach(button => {
            button.addEventListener('click', (event) => {
                const type = event.target.dataset.type;
                let amountInput, dateInput;

                if (type === 'studio') {
                    amountInput = document.getElementById('studioAmount');
                    dateInput = document.getElementById('studioDate');
                } else if (type === 'photo') {
                    amountInput = document.getElementById('photoAmount');
                    dateInput = document.getElementById('photoDate');
                } else if (type === 'video') {
                    amountInput = document.getElementById('videoAmount');
                    dateInput = document.getElementById('videoDate');
                }

                const amount = parseFloat(amountInput.value);
                const date = dateInput.value;

                if (isNaN(amount) || amount <= 0 || !date) {
                    showMessageBox('Please enter a valid amount and date for the revenue.');
                    return;
                }

                revenues.push({ id: generateUniqueId(), type, amount, date });
                saveData();
                renderRevenues(); // Re-render the list to show new entry
                amountInput.value = ''; // Clear input field
                dateInput.value = new Date().toISOString().split('T')[0]; // Reset date to today
                showMessageBox(`${type.charAt(0).toUpperCase() + type.slice(1).replace(/([A-Z])/g, ' $1').trim()} revenue added!`);
            });
        });

        // Event Listener for Adding Expense
        addExpenseBtn.addEventListener('click', () => {
            const amountInput = document.getElementById('expenseAmount');
            const dateInput = document.getElementById('expenseDate');
            const explanationInput = document.getElementById('expenseExplanation');

            const amount = parseFloat(amountInput.value);
            const date = dateInput.value;
            const explanation = explanationInput.value.trim();

            if (isNaN(amount) || amount <= 0 || !date) {
                showMessageBox('Please enter a valid amount and date for the expense.');
                return;
            }

            expenses.push({ id: generateUniqueId(), amount, date, explanation });
            saveData();
            renderExpenses(); // Re-render the list to show new entry
            amountInput.value = ''; // Clear input field
            dateInput.value = new Date().toISOString().split('T')[0]; // Reset date to today
            explanationInput.value = ''; // Clear explanation field
            showMessageBox('Expense added!');
        });

        // Event Listener for Deleting Entries (Delegated)
        document.addEventListener('click', async (event) => {
            if (event.target.closest('.delete-btn')) {
                const button = event.target.closest('.delete-btn');
                const idToDelete = button.dataset.id;
                const type = button.dataset.type;

                const confirmed = await showConfirmBox(`Are you sure you want to delete this ${type} entry?`);

                if (confirmed) {
                    if (type === 'revenue') {
                        revenues = revenues.filter(entry => entry.id !== idToDelete);
                        renderRevenues();
                    } else if (type === 'expense') {
                        expenses = expenses.filter(entry => entry.id !== idToDelete);
                        renderExpenses();
                    }
                    saveData(); // Save changes after deletion
                    showMessageBox(`${type.charAt(0).toUpperCase() + type.slice(1)} entry deleted.`);
                }
            }
        });


        // Initialize the app when the DOM is fully loaded
        document.addEventListener('DOMContentLoaded', initializeApp);

    </script>
</body>
</html>
